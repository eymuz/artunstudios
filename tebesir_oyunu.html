<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Tebe≈üir Hoca - Ortadan Ba≈üla</title>
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#000;}
  canvas{width:100%;height:100%;display:block;}
  #ui{
    position:absolute;top:20px;left:50%;transform:translateX(-50%);
    color:#00ffff;font-family:monospace;font-size:22px;text-shadow:0 0 8px #00ffff;
  }
</style>
<script src="https://cdn.babylonjs.com/babylon.js"></script>
</head>
<body>
<canvas id="renderCanvas"></canvas>
<div id="ui">W: ileri ‚Äî Fareyle bak ‚Äî B/K/E ile cevap ver</div>
<audio id="normalMusic" src="normal.mp3" loop autoplay></audio>
<audio id="panicMusic" src="panic.mp3" loop></audio>
<audio id="hitSound" src="yakalandi.mp3"></audio>

<script>
const canvas=document.getElementById("renderCanvas");
const engine=new BABYLON.Engine(canvas,true);
const scene=new BABYLON.Scene(engine);
scene.clearColor=new BABYLON.Color3(0,0,0);
scene.collisionsEnabled=true;

/* üé• Kamera */
const camera=new BABYLON.FreeCamera("kamera",new BABYLON.Vector3(0,1.5,1000),scene);
camera.attachControl(canvas,true);
camera.keysUp=[87];
camera.checkCollisions=true;
camera.applyGravity=true;
camera.ellipsoid=new BABYLON.Vector3(1,1,1);
scene.activeCamera=camera;
scene.onPointerDown=()=>{if(!document.pointerLockElement)canvas.requestPointerLock();};

/* üí° I≈üƒ±k */
const light=new BABYLON.HemisphericLight("light",new BABYLON.Vector3(0,1,0),scene);
light.intensity=1.6;

/* üß± Uzun koridor */
const uzunluk=5000;
const ground=BABYLON.MeshBuilder.CreateBox("ground",{width:20,height:5,depth:uzunluk},scene);
const gMat=new BABYLON.StandardMaterial("gMat",scene);
gMat.diffuseColor=new BABYLON.Color3(1,1,1);
ground.material=gMat;
ground.position.set(0,-2.5,uzunluk/2);
ground.checkCollisions=true;

const wallMat=new BABYLON.StandardMaterial("wMat",scene);
wallMat.diffuseColor=new BABYLON.Color3(0,0,0);

function duvar(x){
  const w=BABYLON.MeshBuilder.CreateBox("wall"+x,{width:1,height:5,depth:uzunluk},scene);
  w.position.set(x,2.5,uzunluk/2);
  w.material=wallMat;
  w.enableEdgesRendering();
  w.edgesColor=new BABYLON.Color4(1,1,1,1);
  w.checkCollisions=true;
  return w;
}
duvar(-10);
duvar(10);

// üß± Arka duvar (ba≈ülangƒ±√ß noktasƒ±)
const backWall = BABYLON.MeshBuilder.CreateBox("backWall",{width:20,height:5,depth:1},scene);
backWall.position.set(0,2.5,950);
backWall.material=wallMat;
backWall.enableEdgesRendering();
backWall.edgesColor=new BABYLON.Color4(1,1,1,1);
backWall.checkCollisions=true;

// üß± Tavan
const ceil=BABYLON.MeshBuilder.CreateBox("ceil",{width:20,height:1,depth:uzunluk},scene);
const cMat=new BABYLON.StandardMaterial("cMat",scene);
cMat.diffuseColor=new BABYLON.Color3(0,0,0);
ceil.material=cMat;
ceil.position.set(0,5,uzunluk/2);
ceil.checkCollisions=true;

/* üòà Tebe≈üir Hoca */
const hoca=BABYLON.MeshBuilder.CreatePlane("hoca",{width:20,height:6},scene);
const hMat=new BABYLON.StandardMaterial("hMat",scene);
hMat.diffuseTexture=new BABYLON.Texture("hoca.png",scene);
hMat.diffuseTexture.hasAlpha=true;
hMat.backFaceCulling=false;
hMat.alpha=0; // ba≈üta g√∂r√ºnmez
hoca.material=hMat;
hoca.position.set(0,2,0); // √ßok uzakta
hoca.rotation.y=Math.PI;

/* üéÆ Deƒüi≈ükenler */
let a=0,b=0;
let playerSpeed=0.15;
let hocaStep=0.5;
let moving=false;
let oyunBitti=false;
const normal = document.getElementById("normalMusic");
const panic = document.getElementById("panicMusic");
const hit = document.getElementById("hitSound");
normal.volume = 0.8;
panic.volume = 0;


/* üß† Yeni soru */
function yeniSoru(){
  a=Math.floor(Math.random()*100);
  b=Math.floor(Math.random()*100);
  document.getElementById("ui").innerText=`${a} ? ${b}`;
}

/* üéØ Cevap kontrol */
function cevapKontrol(tus){
  if(oyunBitti)return;
  const dogru=a>b?'>':a<b?'<':'=';
  if(tus===dogru){
    playerSpeed=Math.min(playerSpeed+0.05,0.8);
    hocaStep=Math.max(hocaStep-0.05,0.2);
  }else{
    playerSpeed=Math.max(playerSpeed-0.03,0.05);
    hocaStep=Math.min(hocaStep+0.05,1.0);
  }
  yeniSoru();
}

/* üéπ Kontroller */
window.addEventListener("keydown",e=>{
   // Sesleri kullanƒ±cƒ± ilk bastƒ±ƒüƒ±nda ba≈ülat (tarayƒ±cƒ± g√ºvenliƒüi i√ßin)
if (normal.paused) {
  normal.play();
  panic.play();
}

  if(e.key.toLowerCase()==="w")moving=true;
  if(e.key.toLowerCase()==="b")cevapKontrol(">");
  if(e.key.toLowerCase()==="k")cevapKontrol("<");
  if(e.key.toLowerCase()==="e")cevapKontrol("=");
});
window.addEventListener("keyup",e=>{
  if(e.key.toLowerCase()==="w")moving=false;
});

/* üîÅ D√∂ng√º */
let baslangicZamani=Date.now();

scene.onBeforeRenderObservable.add(()=>{
  if(oyunBitti)return;

  const suan=Date.now();
  // 3 saniye sonra hoca g√∂r√ºn√ºr
  if(suan-baslangicZamani>3000 && hMat.alpha<1) hMat.alpha+=0.01;

  if(moving) camera.position.z+=playerSpeed;
  if(camera.position.y<1.4) camera.position.y=1.4;

  // Hoca oyuncuya doƒüru ko≈üar
  const hedef=camera.position.clone(); hedef.y=2;
  const yon=hedef.subtract(hoca.position);
  const mesafe=yon.length();
  yon.normalize();

  if(mesafe>0.3){
    const hiz=hocaStep * Math.min(1.5, 1 + (10/mesafe));
    hoca.position.addInPlace(yon.scale(hiz));
  }

  hoca.lookAt(new BABYLON.Vector3(camera.position.x,2,camera.position.z));
// M√ºzik ses ge√ßi≈üi: Tebe≈üir yakla≈üƒ±rsa panic sesi y√ºkselir
let panicVol = 1 - (mesafe / 80);
panicVol = Math.max(0, Math.min(1, panicVol));
const fadeSpeed = 0.02;
normal.volume = 0.8 - panicVol * 0.8;
panic.volume += (panicVol - panic.volume) * fadeSpeed;


  if(mesafe<0.2){
hit.play();
normal.pause();
panic.pause();
    oyunBitti=true;
    document.getElementById("ui").innerText="üíÄ Tebe≈üir Hoca seni yakaladƒ±!";
  }
});

yeniSoru();
engine.runRenderLoop(()=>scene.render());
window.addEventListener("resize",()=>engine.resize());
</script>
</body>
</html>
